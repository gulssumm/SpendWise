<Window x:Class="SpendWise.Presentation.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SpendWise.Presentation.Views"
        xmlns:viewModels="clr-namespace:SpendWise.Presentation.ViewModels"
        xmlns:converters="clr-namespace:SpendWise.Presentation.Converters"
        mc:Ignorable="d"
        Title="SpendWise - Financial Management System" 
        Height="650" Width="950"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <converters:ExpenseColorConverter x:Key="ExpenseColorConverter"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="400"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*" MinWidth="350"/>
        </Grid.ColumnDefinitions>

        <!-- Master View - Transaction List -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="#2c3e50" Padding="15">
                <TextBlock Text="Transactions" FontSize="22" FontWeight="Bold" Foreground="White"/>
            </Border>

            <!-- Balance Info -->
            <Border Grid.Row="1" Background="#ecf0f1" Margin="0,0,0,10" Padding="15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Current Balance" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding TransactionListViewModel.CurrentBalance, StringFormat=\{0:C\}}" 
                                   FontSize="22" FontWeight="Bold" 
                                   Foreground="{Binding TransactionListViewModel.CurrentBalance, Converter={StaticResource ExpenseColorConverter}, ConverterParameter=Balance}"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="Add Transaction" 
                                Command="{Binding TransactionListViewModel.AddNewTransactionCommand}"
                                Padding="10,5" Margin="0,0,10,0" Background="#3498db" Foreground="White" BorderBrush="#2980b9"/>
                        <Button Content="Refresh" 
                                Command="{Binding TransactionListViewModel.RefreshCommand}"
                                Padding="10,5" Background="#95a5a6" Foreground="White" BorderBrush="#7f8c8d"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Search/Filter Controls (Fixed) -->
            <Grid Grid.Row="2" Margin="15,0,15,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Search TextBox with watermark -->
                <TextBox Grid.Column="0" Margin="0,0,10,0" Padding="5">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TextBox">
                                        <Grid>
                                            <TextBox Text="{Binding Path=Text, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}" 
                                                     Background="Transparent" 
                                                     Padding="5"
                                                     Panel.ZIndex="2" />
                                            <TextBlock Text="Search transactions..." 
                                                       Foreground="Gray"
                                                       Padding="5"
                                                       Margin="2,2,0,0"
                                                       Visibility="{Binding Path=Text.IsEmpty, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisConverter}}" 
                                                       Panel.ZIndex="1"/>
                                        </Grid>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TextBox.Style>
                </TextBox>

                <ComboBox Grid.Column="1" Width="120" Padding="5"
                         SelectedIndex="0">
                    <ComboBoxItem Content="All Transactions"/>
                    <ComboBoxItem Content="Expenses Only"/>
                    <ComboBoxItem Content="Income Only"/>
                </ComboBox>
            </Grid>

            <!-- Transaction List -->
            <ListView Grid.Row="3" Margin="15,0,15,15"
                      ItemsSource="{Binding TransactionListViewModel.Transactions}" 
                      SelectedItem="{Binding TransactionListViewModel.SelectedTransaction, Mode=TwoWay}"
                      BorderThickness="1" BorderBrush="#bdc3c7">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Description" Width="180">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Description}" ToolTip="{Binding Description}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Amount" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Amount, StringFormat=\{0:C\}}" 
                                               Foreground="{Binding IsExpense, Converter={StaticResource ExpenseColorConverter}}" 
                                               HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="Category" DisplayMemberBinding="{Binding Category}" Width="120"/>
                        <GridViewColumn Header="Date" DisplayMemberBinding="{Binding Date, StringFormat=\{0:d\}}" Width="100"/>
                    </GridView>
                </ListView.View>
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="Padding" Value="5" />
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
        </Grid>

        <!-- Splitter -->
        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="#bdc3c7"/>

        <!-- Detail View - Transaction Details -->
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="#2c3e50" Padding="15">
                <TextBlock Text="Transaction Details" FontSize="22" FontWeight="Bold" Foreground="White"/>
            </Border>

            <!-- Content -->
            <Grid Grid.Row="1" Margin="15">
                <!-- No Selection Message -->
                <TextBlock 
                    Text="Please select a transaction from the list or click 'Add Transaction'" 
                    TextWrapping="Wrap" FontSize="16" Foreground="#7f8c8d" 
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    Visibility="{Binding DetailViewModel, Converter={StaticResource BoolToVisConverter}, ConverterParameter=inverse}"/>

                <!-- Transaction Form -->
                <Grid Visibility="{Binding DetailViewModel, Converter={StaticResource BoolToVisConverter}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                        <StackPanel DataContext="{Binding DetailViewModel}" Margin="0,10,0,0">
                            <TextBlock Text="Description" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                                     Padding="8" Margin="0,0,0,15"/>

                            <TextBlock Text="Amount" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Amount, UpdateSourceTrigger=PropertyChanged}" 
                                     Padding="8" Margin="0,0,0,15"/>

                            <TextBlock Text="Transaction Type" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <RadioButton Content="Expense" IsChecked="{Binding IsExpense}" Margin="0,0,15,0"/>
                                <RadioButton Content="Income" IsChecked="{Binding IsExpense, Converter={StaticResource InverseBoolConverter}}"/>
                            </StackPanel>

                            <TextBlock Text="Category" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding Category, UpdateSourceTrigger=PropertyChanged}" 
                                     Padding="8" Margin="0,0,0,15"/>

                            <TextBlock Text="Date" FontWeight="SemiBold" Margin="0,0,0,5"/>
                            <DatePicker SelectedDate="{Binding Date}" Padding="5" Margin="0,0,0,15"/>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Buttons -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0" 
                                DataContext="{Binding DetailViewModel}">
                        <Button Content="Save" Command="{Binding SaveCommand}" 
                                Padding="20,8" Margin="0,0,10,0" Background="#27ae60" Foreground="White" BorderBrush="#219955"/>
                        <Button Content="Cancel" Command="{Binding CancelCommand}" 
                                Padding="20,8" Background="#e74c3c" Foreground="White" BorderBrush="#c0392b"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Window>